* deduplicate code and template from various defines
